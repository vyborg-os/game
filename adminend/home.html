<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="assets/css/auth.css">
    <link rel="stylesheet" href="assets/fonts/webfonts/fa-brands-400.ttf">
    <!-- <link rel="stylesheet" href="assets/css/style.css"> -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

</head>
<body>
    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8">
                <center><h1>Games List</h1></center>
                    <!-- Games table -->
                    <table id="games-table" class="table table-responsive table-bordered">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Details</th>
                                <th>Image</th>
                                <th>ReleaseDate</th>
                            
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Games will be populated here -->
                        </tbody>
                    </table>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4">
                <center><h1>Add Game</h1></center>
                    <form id="add-game-form" class="form-control">
                        <label for="title">Title:</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                        <br>
                        <label for="category">Category:</label>
                        <input type="text" class="form-control" id="category" name="category">
                        <br>
                        <label for="details">Details:</label>
                        <textarea id="details" class="form-control" name="details"></textarea>
                        <br>
                        <label for="releaseDate">Release Date:</label>
                        <input type="date" class="form-control" id="releaseDate" name="releaseDate">
                        <br>
                        <label for="image">Image:</label>
                        <input type="file" class="form-control" id="image" name="image">
                        <br>
                        <button type="submit">Add Game</button>
                    </form>
            </div>
    </div>
</div>


    <script>
        // Fetch and display existing games
        fetchGames();

        async function fetchGames() {
            console.log(localStorage.getItem('token'));
            try {
                const response = await fetch('http://localhost:3000/api/admin/games', {
                    headers: {
                        // Add authorization header with token from local storage
                        'Authorization': `${localStorage.getItem('token')}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch games: ${response.status} ${response.statusText}`);
                }

                const games = await response.json();
                const gamesTableBody = document.querySelector('#games-table tbody');

                // Clear existing tables
                gamesTableBody.innerHTML = '';

                // Check if response is an array
                if (!Array.isArray(games)) {
                    throw new Error('Invalid response format: Expected an array of games');
                }

                // Populate table with fetched games
                games.forEach(game => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${game.title}</td>
                        <td>${game.category}</td>
                        <td>${game.details}</td>
                        <td>${game.image}</td>
                        <td>${game.releaseDate}</td>
                    `;
                    gamesTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('An error occurred:', error);
            }
        }


        // Handle form submission to add a new game
    const addGameForm = document.getElementById('add-game-form');
        addGameForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(addGameForm);
            const title = formData.get('title');
            const category = formData.get('category');
            const details = formData.get('details');
            const releaseDate = formData.get('releaseDate');
            const image = formData.get('image');
            console.log(localStorage.getItem('token'));
            try {
                const response = await fetch('http://localhost:3000/api/admin/game', {
                    method: 'POST',
                    headers: {
                        // Send the JWT token in the 'Authorization' header
                        'Authorization': `${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                if (response.ok) {
                    // Game added successfully, fetch and display updated games list
                    //fetchGames();
                    console.log('game added successfully')
                } else {
                    const errorData = await response.json();
                    console.error('Failed to add game:', errorData.error);
                }
            } catch (error) {
                console.error('An error occurred:', error);
            }
        });
    </script>
</body>
<script src="assets/js/bootstrap.min.js"></script>
</html>
